<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">
<h:body>
	<ui:composition template="/layouts/basic-10.xhtml">
		<ui:param name="managedBean" value="#{geminiDataBean}" />
		<ui:define name="title">ChatWithAi</ui:define>
		<ui:define name="content">
			<h3>AI Chat</h3>
			<h:form id="form">
				<div>
					<p:outputLabel for="option" value="Model" />
					<p:selectOneMenu id="option" value="#{managedBean.model}">
						<f:selectItems value="#{managedBean.onSelectModel()}" var="type"
							itemLabel="#{type.getName()}" itemValue="#{type}" />
					</p:selectOneMenu>
				</div>
				<p:panelGrid columns="1" layout="grid"
					styleClass="ui-panelgrid-blank ui-fluid">

					<ui:repeat var="content" value="#{managedBean.requestContents}">
						<p:panel rendered="#{content.role == 'user'}">
							<p:outputLabel value="#{content.role}" style="font-weight:bold;" />
							<p:outputLabel value="#{content.parts.get(0).text}"
								style="white-space: pre-line; display:block; margin-bottom:20px;" />
						</p:panel>

						<p:panel rendered="#{content.role == 'model'}">
							<p:outputLabel value="#{content.role}"
								style="font-weight:bold; color: red" />
							<p:outputLabel value="#{content.parts.get(0).text}"
								style="white-space: pre-line; display:block; margin-bottom:20px;" />
						</p:panel>
					</ui:repeat>
					<p:textEditor widgetVar="editor" id="editor"
						value="#{managedBean.inputedMessage}" allowImages="true"
						height="150" style="margin-bottom:10px"
						placeholder="How can I help you today?">
						<f:facet name="toolbar">
							<span class="ql-formats">
								<button class="ql-image"></button>
							</span>
						</f:facet>
					</p:textEditor>


				</p:panelGrid>
				<br />
				<div class="command-btns">
					<p:commandButton id="refresh" value="refresh" update="form"
						actionListener="#{managedBean.onCleanText()}" icon="pi pi-refresh" />
					<p:commandButton id="proceed" value="send" update="form"
						actionListener="#{managedBean.onSendRequest()}" icon="pi pi-check" />
				</div>
			</h:form>
			<script type="text/javascript">
				 function handlePaste(event) {
				 	var clipboardData = event.clipboardData || window.clipboardData;
            		var items = clipboardData.items;
	            	for (var i = 0; i &lt; items.length; i++) {
	            		if (items[i].type.indexOf('image') !== -1) {
		                    var file = items[i].getAsFile();
		                    var reader = new FileReader();
		
		                    reader.onload = function(evt) {
		                        var base64Image = evt.target.result;
		                        // Insert the image into the editor
		                        var quill = PF('editor').editor;
		                        var range = quill.getSelection();
		                        quill.insertEmbed(range.index, 'image', base64Image);
		                    };
		
		                    reader.readAsDataURL(file);
		                }
	            	}
	   
        		}
        		document.addEventListener('paste', function(event) {
		            var editor = PF('editor').editor.root;      
		                handlePaste(event);
		        });
			</script>
		</ui:define>
	</ui:composition>
</h:body>

</html>